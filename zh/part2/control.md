# 控制模块

本章将介绍如何执行前面已经创建好的照明计划。

本章还将介绍到控制模块提供的多种查看设备信息和通讯状态的入口，方便对照明系统进行管理和监控。

## 地图视图

在地图视图中，设备将按照真实地理位置分布，便于管理，点击各个设备图标，即可查看设备信息，进行设备控制。

> **说明**：使用这项功能之前，需要在`设备` 中添加设备，并将`地图定位`中将相应设备放置在地图上。

### 查看设备状态

点击`控制` - `地图视图`，拖拽地图移动到目标位置，滚动鼠标滚轮放大和缩小地图。
设备较多时，还可通过搜索框定位到设备。在搜索框中输入设备名称的关键字，点击`确定`后，将定位到设备所在区域，并将设备放置在视图中间，如下图。

![智慧路灯的位置查询](img/iLamp_location.png '智慧路灯的位置查询')

#### 智慧路灯

点击 智慧路灯 图标，将显示LED显示屏 当前播放的画面 、屏的状态（`当前亮度`，`亮度模式`，`通信状态`，`故障信息`）和 `传感器的状态`，包括`PM2.5`，`温度`，`湿度`等，如下图所示。

![屏与传感器的状态](img/screen_sensor_status.png '屏与传感器的状态')

#### 灯

点击普通路灯的图标，将显示灯的状态（`亮度`，`灯状态`，`通信状态`，`灯具`），如下图所示。

![灯的状态](img/map_lamp_status.png '灯的状态')

#### 充电桩

点击 `充电桩` 的图标，将显示充电桩的状态（`设备状态`，`上次充电完成时刻`，`上次充电时长`，`上次充电量`，`累计充电时长`，`累计充电量`，`累计充电次数`），如下图所示。

![充电桩的状态](img/map_charging_pile_status.png '充电桩的状态')

### 灯控

1. 依次点击`控制` - `地图视图`，点击地图上的智慧路灯或普通路灯的图标，弹出对应的对话框，如下图所示；  ![智慧路灯](img/control_iLamp.png '智慧路灯')

    ![普通路灯](img/control_lamp.png '普通路灯')

2. 点击对话框中的 `控制`，选择一种调光策略，详见以下章节。

   > **注意**：调光前，请先确认相关控制器的调光方式为 `远程`，否则将导致调光失败。

#### 手动调光

在调光或组调光列里选中 `手动`，用鼠标拖动下方的按钮从 *0* - *100* 任意调节，最后点击`提交`，如下图所示：  ![手动调光](img/manual_dimming.png '手动调光')

#### 时间亮度表调光

应用时间亮度表后，设备将按照表中定义好的规则，在特定的时间段内，调成指定亮度。

点击对话框中的 `控制`，在调光或组调光列里选中 `时间亮度表`，在下方的下拉菜单中选中一个 `时间亮度表`，最后点击 `提交` ，如下图所示：  ![时间亮度表调光](img/time_brightness_dimming.png '时间亮度表调光')

> **说明**：需要先在`配置` - `时间亮度表`中设置好时间亮度表。

#### 自动亮度表调光

应用自动亮度表后，设备将按照表中定义好的关系曲线和节点，根据传感器的输入数值，调成指定亮度。

点击对话框中的 `控制`，在调光或组调光列里选中 `自动亮度表` ，在下方的下拉菜单中选中一个 `自动亮度表`，最后点击 `提交` ，如下图所示：  ![自动亮度表调光](img/auto_dimming.png '自动亮度表调光')

> **说明**：需要先在`配置` - `自动亮度表`中设置好自动亮度表。

### 控制器校时

对控制器校时，能使各设备时间与服务器同步，从而更准确执行时间亮度表或紧急控制表等照明计划。

1. 依次点击 `控制` - `地图视图`，点击地图上的 `控制器` 图标，弹出对应的对话框，如下图所示：![控制器](img/controller.png '控制器')
2. 点击 `控制` - `校时`，弹出校时成功，如下图所示：![控制器校时成功](img/controller_success.png '控制器校时成功')

> **说明**：控制器校时是以服务器所在电脑的时间给控制器及其辖下的各盏灯进行时钟校准。

### 激活播放列表

播放列表定义了智慧路灯上的广告板播放内容。在系统中添加智慧路灯及其广告屏，并上传播放列表，之后可以在`地图视图`中，将播放列表上传到设备进行显示，即激活播放列表。

> **说明**：如何添加播放列表参见 [配置 ](part2/config.md) - [播放列表]()章节。

1. 点击 `智慧路灯` 图标，弹出对应的对话框，如下图所示：![智慧路灯](img/wisdom_street_lamps.png '智慧路灯')
2. 点击 `控制` - `激活播放列表`，在激活播放列表的下拉菜单中选中一个播放列表，然后点击 `提交`，如下图所示：![激活播放列表](img/activates_playlist.png '激活播放列表')

## 快捷操作 - 组内灯场景应用

点击 `控制` - `快捷操作`，场景分组进行显示，选中目标场景点击 `应用`，如下图所示：  ![快捷操作](img/shortcuts.png '快捷操作')

  > **说明**：
  >
  > 1. 如何定义场景详见 [配置 ](part2/config.md) - [配置场景]()章节。
  > 2. 创建好的场景还需进行分组后才能进行快捷应用，场景分组详见 [配置 ][part2/config.md] - [场景分组][]章节。

## 查看控制器状态

点击 `控制` - `控制器`，将显示控制器的状态（`通信状态`，`设备状态`，`调光模式`），如下图所示：  ![控制器的状态](img/controller_status.png '控制器的状态')

此种方式查看到的控制器信息与在`地图视图`中看到的一致，不同的是，此处显示了批量控制器的信息，便于进行常规检查，掌握整体情况。

## 查看灯的状态

点击 `控制` - `灯`，将显示灯的状态（`通信状态`，`灯具`，`亮度`，`电压`，`电流`，`功率`，`上电时间`），如下图所示：  ![灯的状态](img/lamp_status.png '灯的状态')

此种方式查看到的控制器信息与在`地图视图`中看到的一致，不同的是，此处显示了批量控制器的信息，便于进行常规检查，掌握整体情况。

## 查看充电桩的状态

点击 `控制` - `充电桩`，会显示充电桩的状态（`充电桩编号`，`设备状态`，`上次充电完成时刻`，`上次充电时长`，`上次充电量`，`累计充电时长`，`累计充电量`，`累计充电次数`），如下图所示：  ![充电桩的状态](img/charging_pile_status.png '充电桩的状态')

此种方式查看到的控制器信息与在`地图视图`中看到的一致，不同的是，此处显示了批量控制器的信息，便于进行常规检查，掌握整体情况。

## 系统控制

本节将介绍在控制器的两种工作模式下，如何应用照明计划。同时，为偶发的故障制定紧急调光策略。

### 设置工作模式

自动模式下，控制器将执行紧急时控计划，而手动模式下，控制器随时接受服务器端指令，如在地图视图中进行调光和在快捷操控中应用场景。

1. 点击 `控制` - `系统控制`。
2. 找到目标控制器，点击 `AUTO` （自动）或 `REMOTE`（远程）进行切换。
3. 点击 `应用`。![控制器的工作模式设置](img/controller_work_mode.png '控制器的工作模式设置')

### 设置紧急调光策略

当由于通讯故障等原因，控制器检测不到系统一段时间后，将执行紧急调光策略，设置方法如下：

1. 点击 `控制` - `系统控制`，找到目标控制器。
2. 选择 `故障亮度`、`上一次亮度`或`紧急时控计划` 。
3. 在触发时间后的方框内填写分钟数。
   *例如填写30分钟，表示控制器每30分钟与系统进行通讯，如果通讯失败，则触发紧急调光策略。*
4. 点击 `应用` 。  ![控制器的紧急调光策略](img/emergency_dimming_strategy.png '控制器的紧急调光策略')

### 指定紧急时控计划表

指定的紧急时控计划，将被用于*Auto*模式下的执行计划，或*Remote*模式下，紧急调光策略的执行计划（须在紧急调光策略中选择紧急时控计划选项）。

1. 点击 `控制` - `系统控制`，找到目标控制器。
2. 在对应的紧急时控计划表列种，点击打开下拉菜单，选择计划表。如下图。
3. 点击 `应用`。![控制器的紧急时控计划](img/emergency_control_plan.png '控制器的紧急时控计划')

> **说明**：如何设置紧急时控计划表参见  [配置 ](part2/config.md) - [紧急控制]()章节。