# 设备管理

本章介绍照明管理系统的设备管理。这些设备包括，控制器、灯、传感器和智慧路灯，请查看以下对应的章节。

## 控制器管理

一个控制器通常连接、管理着若干灯，负责与服务端进行通信，传达服务器指令到灯。
当在照明管理系统上对控制器进行校时操作时，该控制器辖下的所有灯具时钟也相应得到了校准。

添加灯之前，请先添加控制器。

### 添加控制器

1. 点击 `设备` - `控制器` - `+添加控制器`。
2. 在弹出的对话框中输入控制器的`名称`、`设备地址`、`IP地址`、`端口号`和`备注`（选填）后，点击 `提交` 按钮即可，如下图所示。

  ![添加控制器](img/device_addController.png '添加控制器')  

* 设备地址：控制器的MAC地址，可在设备的出厂说明文档中找到。
* IP地址：控制器的网络地址，请确保服务器和控制器所在网络互通。
* 端口：默认*3434*，如果此端口号被占用，请测试找出并填写其他可用端口号。

### 编辑控制器

1. 点击 `设备` - `控制器`。
2. 找到需要修改的控制器，点击![](img/Edit.png)按钮。
3. 在弹出的对话框中输入该控制器需要修改的 `名称`、`设备地址`、`IP地址`或`端口号` 后点击 `提交` 按钮即可，如下图所示。

  ![编辑控制器](img/device_editController.png '编辑控制器')

### 删除控制器

1. 点击 `设备` - `控制器`。
2. 找到在需要删除的控制器，点击![](img/Trash_bin.png)。
3. 在弹出的确认删除的对话框中，点击 `确认` 按钮即可，如下图所示。

  ![删除控制器](img/device_delController.png '删除控制器')

### GPS 定位控制器

1. 点击 `设备` - `控制器`。
2. 找到需要定位的控制器，点击![](img/Location.png)。
3. 在弹出的GPS位置编辑的对话框中输入经度和纬度后点击 `提交` 按钮即可，如下图所示。

  ![GPS 定位控制器](img/device_GPSLocation.png 'GPS 定位控制器')

> **说明**: 系统将进行检测，如果输入了不合理字符或超出经纬度范围的数值，输入框边框将变成红色，并且无法进行提交。

## 灯

配置灯与配置控制器类似，分别可实现 `添加灯`、`编辑灯`、`删除灯`和`GPS定位灯`的功能，整体配置界面如下图所示。

  ![配置灯](img/device_configLamp.png '配置灯')

> **注意**：
>
> * 添加灯前，请确保已经添加了与之相连接的控制器。
> * 添加灯时，请准确选择与该灯相连接的控制器。

## 灯的分组

将灯指配到分组中以后，可以在紧急控制计划中进行批量指定或在地图中进行组调光。

> **说明**：紧急控制计划表适用于控制器与服务器网络无法一直联通的场景，将控制器设置为自动后，自动应用紧急控制计划。同时，在网络通畅的场景中，也可作为网络中断等突发情况的备用方案。

### 添加灯的分组

1. 点击 `设备` - `分组` - `+ 添加组` 。
2. 在弹出添加组的对话框中输入组名后点击 `提交` 即可，如下图所示。
   ​![添加灯的分组](img/device_addLampGroup.png '添加灯的分组')

> **说明**：新建组为空，因此表示组内灯数量的黄圈标示数字为0，代表此时组内没有任何设备。

### 编辑灯组名称

1. 点击 `设备` - `分组`。
2. 找到需要修改的分组，点击![](img/Pensil.png)，随后![](img/Pensil.png)按钮变为![](img/Check.png)，此时可在名称栏中输入新的组名称。
3. 修改好后点击![](img/Check.png)即可，如下图所示。
   ​![编辑灯组名称](img/device_editLampGroupName.png '编辑灯组名称')

### 添加或移除组中的灯

1. 点击 `设备` - `分组`。
2. 选中需要添加灯的组。
3. 选择 `非组内灯` 下方的灯，通过 `>` 或 `>>` 将其添加到组内；
   选择组内灯下方的灯通过 `<` 或 `<<` 将其移除组，如下图所示。
   ​![添加或移除组中的灯](img/device_addOrRemoveLamp.png '添加或移除组中的灯')

不同按钮功能如下：

|  按钮  | 功能              |
| :--: | :-------------- |
|  >   | 从非组内移动选中的一个灯到组内 |
|  >>  | 从非组内移动所有的灯到组内   |
|  <   | 从组内移动选中的一个灯到非组内 |
|  <<  | 从组内移动所有的灯到非组内   |

> **说明**：
>
> * 每个分组后的黄圈标示数字代表该组内设备数量。
> * 选中一个分组后， 左侧的`非组内灯` 列出的是不在这个分组内的灯；右侧的 `组内灯`列出的是在这个分组中的灯。 

### 删除分组

1. 点击 `设备` - `分组`。
2. 选中需要删除的组，点击下方的 `删除组` 按钮。
3. 在弹出的确认对话框，点击 `确认` 按钮即可，如下图所示。
   ​![删除灯组](img/device_delLampGroup.png '删除灯组')

## 传感器管理

可添加、管理传感器设备。智慧路灯中的传感器请先在智慧路灯模块中进行添加。

### 添加传感器

1. 点击 `设备` - `传感器` - `+添加传感器`。
2. 在弹出的添加传感器对话框中输入传感器的 `名称` ，选择 `类型` 后。
3. 点击 `提交` 按钮即可，如下图所示。
   ![添加传感器](img/device_addSensor.png '添加传感器')

### 编辑传感器

1. 点击 `设备` - `传感器`。
2. 找到需要修改的传感器，点击对应的![](img/Edit.png)按钮。
3. 在弹出的编辑传感器对话框中，修改 `名称` 或 `类型` 。
4. 点击 `提交` 按钮，如下图所示。
   ![编辑传感器](img/device_editSensor.png '编辑传感器')

### 删除传感器

1. 点击 `设备` - `传感器`。
2. 找到需要删除的传感器，点击相应的![](img/Trash_bin.png)按钮。
3. 在弹出的确认对话框中，点击 `确认` 按钮即可，如下图所示。
   ![删除传感器](img/device_delSensor.png '删除传感器')

## 地图定位

完成设备添加后，在`地图定位`中放置好各设备的位置，即可在`控制` - `地图视图`中，根据地理位置，选中并查看设备信息，控制设备等。

![地图定位 - 查看设备地理位置](img/device_mapLocation.png '地图定位 - 查看设备地理位置')

### 放置设备

1. 点击 `设备` - `地图定位`，鼠标拖动地图移动到目标位置，鼠标滚轮可放大缩小地图。

2. 根据需要添加的设备类型，点击相应按钮： `灯`、`控制器`、`智慧路灯`、`充电桩` 。

3. 此时左侧的设备列表将筛选出相应的设备类型，并根据分组进行显示，找到并选择需要放置的设备。

   > **说明**：通过在设备列表上的搜索框中输入设备名称关键字，可以快速筛选出目标设备。如上图，输入4，可筛选出名字中包含4的灯。

4. 点击![](img/Location_Plain.png)， 将鼠标移动地图上，光标变成相应的设备图标，找到目标位置，点击鼠标进行放置。
   系统提示添加成功。

### 调整设备位置

1. 点击 `设备` - `地图定位`。

2. 鼠标拖动地图找到目标位置，鼠标滚轮可放大缩小地图。
   还可在地图右上方的 `Search`搜索框中输入设备名称关键字，如上图，输入 *4* 后按 `确认` 按钮，系统即定位并显示该设备所在的位置。

3. 点击![](img/Edit_Plain.png)， 将鼠标移动地图上，光标后跟随操作提示：找到目标后，按住鼠标不放，将设备拖动到目标位置。

4. 重复上述步骤，直至所有设备都完成修改。

5. 点击`Save`按钮保存修改。

   系统提示修改成功。

### 从地图上删除设备

1. 点击 `设备` - `地图定位`。

2. 鼠标拖动地图找到目标位置，鼠标滚轮可放大缩小地图。
   还可在地图右上方的 `Search`搜索框中输入设备名称关键字，如上图，输入 *4* 后按 `确认` 按钮，系统即定位并显示该设备所在的位置。

3. 点击![](img/Trash_Bin_Plain.png)， 将鼠标移动地图上，光标后跟随操作提示：找到目标后并点击目标设备。

4. 重复上述步骤，直至完成所有删除。

5. 点击`Save`按钮保存修改。

   系统提示删除成功。

## 配置光栅地图

> **说明**：使用在线地图或者离线地图模式的，无需配置本项。

光栅地图适用于室内或者范围较小的区域，通过在线地图无法达到的精度。请根据需要，联系经销商，切换选择光栅地图、在线地图或者离线地图。

在`光栅地图`中上传好光栅地图，并在`设备` - `地图定位`中放置好设备位置后，可在`控制` - `地图视图`中，根据地理位置，选中并查看设备信息，控制设备等。 

![配置光栅地图](img/device_rasterMap.png '配置光栅地图')

## 应用更改

添加完控制器和灯，编辑好分组信息后，需要重启服务，使服务器到读取到最新数据。

1. 点击`设备` - `重启服务`，进入到重启服务界面，点击`重启`按钮即可将所有控制器和灯的更新信息应用到服务端，如下图所示。
   ![重启服务](img/device_restartService.png '重启服务')


2. 重启后，点击`设备` - `发布设置`，找到本次配置的相关控制器，并点击`发布`按钮，将更改发送到控制器上。

## 分组配置调光参数

使用默认参数即可。正常状态下，非专业人员请勿修改本页参数。

![分组配置调光参数](img/device_dimmingParams.png '分组配置调光参数')

>注：该配置仅对以分组为单位的灯有效。

## 配置智慧路灯

智慧路灯是智慧城市的重要组成部分，它是集成了照明、实时数据监测、视频监控、发布电子广告和应急充电等多种功能于一体的智能产品。照明管理系统可添加、管理智慧路灯及其子设备。

### 添加智慧路灯

1. 点击`设备`-`智慧路灯`-`+添加智慧路灯`。
2. 在弹出的对话框中输入智慧路灯的名称后点击`提交`按钮即可，如下图所示。

![添加智慧路灯](img/device_addIntelligentLamp.png '添加智慧路灯')

### 编辑智慧路灯

#### 编辑智慧路灯名称

1. 点击`设备`-`智慧路灯`。
2. 选择需要修改的智慧路灯，点击![](img/Pensil.png)的按钮，随后铅笔形按钮变为![](img/check.png)。
3. 名称栏中输入新的智慧路灯名称，修改好后点击![](img/check.png),如下图所示。
   ![编辑智慧路灯名称](img/device_editIntelligentLamp.png '编辑智慧路灯名称')

#### 添加灯设备

在智慧路灯中添加灯，需要现在`设备` - `控制器`和`设备` - `灯`中分别添加了控制器和灯后，再执行以下步骤，将对应的灯关联到智慧路灯上。添加控制器和灯的步骤，请查看本章相应章节。

1. 点击`设备` - `智慧路灯`。
2. 选中需要添加设备的智慧路灯。
3. 打开`灯`选项卡，点击`+添加灯`，弹出添加灯对话框。
4. 在`Search`查询框中输入设备的名称关键字（如输入*4*，将筛选出包含*4*的设备）。
5. 在下拉表单中选择某一盏灯点击`提交`按钮，如下图所示。

![添加灯设备](img/device_intelligentLamp_addLamp.png '添加灯设备')

>**说明**：同添加时一样，修改和删除灯，请转到`设备管理` - `灯`页面。相关步骤，请参考本章中相应章节。

#### 添加传感器设备

一个智慧路灯可添加`环境噪声`、`PM2.5`、`气压`、`温度`、`湿度`、`风速`和`风向`传感器。添加步骤如下：

1. 点击`设备` - `智慧路灯`。
2. 选中需要添加设备的智慧路灯。
3. 打开`传感器`选项卡，点击`+添加传感器`，弹出添加对话框。
4. 在下拉表单中选择传感器类型。
5. 点击`提交`。
   ![添加传感器设备](img/device_intelligentLamp_addSensor.png '添加传感器设备')

添加完成后，可到`设备管理` - `传感器`中编辑传感器名称。

#### 添加摄像机设备

添加摄像机后，在地图视图上点击智慧路灯图标即可查看该摄像机上的实时监控画面。添加步骤如下：

1. 点击`设备` - `智慧路灯`。
2. 选中需要添加设备的智慧路灯。
3. 打开`摄像机`选项卡，点击`+添加摄像机`，弹出添加对话框。
4. 在对话框中输入此摄像机的`IP地址`、`端口号`、`用户`、`密码`、`通道`和选择`类型`后点击`提交`按钮，如下图所示。以上信息，除IP地址外，如无特殊情况，请使用摄像机提供的默认参数。
5. 点击`提交`。

![添加摄像机设备](img/device_intelligentLamp_addCamera.png '添加摄像机设备')

#### 添加RFID设备

添加RFID设备后，在地图视图上点击智慧路灯图标即可查看RFID设备的相关信息。添加步骤如下：

1. 点击`设备` - `智慧路灯`。
2. 选中需要添加设备的智慧路灯。
3. 打开`RFID`选项卡，点击`+添加RFID`，弹出添加对话框。
4. 在对话框中选择设备`类型`，填写`IP地址`和端口`地址`等信息。其中阅读器`类型`需要输入`IP地址`和`地址`两项，而触发器和标签类型只需输入`地址`一项即可，如下图所示。
5. 点击`提交`。
   ![添加RFID设备](img/device_intelligentLamp_addRfid.png '添加RFID设备')

#### 添加屏设备

添加显示屏后，可上传播放列表，管理显示屏的播放内容。在地图视图上点击智慧路灯图标即可查看显示屏的实时播放内容。
添加步骤如下：

1. 点击`设备` - `智慧路灯`。
2. 选中需要添加设备的智慧路灯。
3. 打开`屏`选项卡，点击`+添加屏`，弹出添加对话框。
4. 在对话框中输入其`IP地址`和`端口号`，选择此屏的`分辨率`，如下图所示。
5. 点击`提交`。
   ![添加屏设备](img/device_intelligentLamp_addScreen.png '添加屏设备')

#### 添加充电桩设备

添加显示屏后，在地图视图上点击智慧路灯图标即可查看充电桩的信息。
添加步骤如下：

1. 点击`设备` - `智慧路灯`。
2. 选中需要添加设备的智慧路灯。
3. 打开`充电桩`选项卡，点击`+添加充电桩`，弹出添加对话框。
4. 在`Search`查询框中输入设备的名称关键字（如输入*4*，将筛选出包含*4*的设备）。
5. 在下拉表单中选择目标充电桩，如下图所示。
6. 点击`提交`。
   ![添加充电桩设备](img/device_intelligentLamp_addChargingPile.png '添加充电桩设备')

### 删除智慧路灯

1. 点击`设备`-`智慧路灯`。
2. 选择需要修改的智慧路灯，点击`删除`按钮
3. 在弹出的确认对话框中，点击`确认`按钮即可，如下图所示。
   ![删除智慧路灯](img/device_deleteLamp.png '删除智慧路灯')